<script>
customElements.define('flytxt-login', class extends HTMLElement{
  constructor(){
    super();
  
    const template = document.createElement('template');
    template.innerHTML = ` 
      <style>
        .login{
          width:515px;
          height:auto;
          position: relative;
        }
        .login-form{
          position: absolute;
          top: 130px;
          left: 50px;
          width: 390px;
        }
        .images{
          overflow:hidden;  
          margin-bottom: 20px;
          padding-bottom:15px;
        }
        .left-img{
          width:95px;
          float:left
        }
        .right-img{
          width:95px;
          float:right
        }
        .right-img img{
          height: 16px;
          margin-top: 10px;
        }
        .form-groub {
          padding-bottom: 15px;
          position: relative;
          height: 50px;
        }
        .form-groub input:focus + label{
          top:-12px;
          font-size:0.8em
        }
        .form-groub input.has-value +label{
          top:-12px;
          font-size:0.8em
        }

        .form-groub input:focus{
          outline:none; 

        }
        .form-groub label{
          position: absolute;
          top: 10px;
          font-size: 1.2em;
          color: #666;
          transition: 0.2s all;
        }
        .form-groub input{
          width: 100%;
          height: 30px;
          border: none;
          border-bottom: 1px solid #171a28;
          font-size: 18px;
          color: #444;
        }
        .form-groub-checkbox{
          overflow:hidden;
        }
        .form-groub-checkbox input{
          width: 16px;
          height: 16px;
          vertical-align: sub;
        }
        .form-groub-checkbox div{
          width: 130px;
          float: right;
          font-size: 14px;
          color: #666;
        }
        
        .form-groub-submit{
          margin-top: 15px;
          margin-bottom: 20px;
        }
        .form-groub-submit img{
          width:40px;
        }
        .form-groub-submit button{
          font-size: 20px;
          color: #fff;
          background: #F8A02B;
          outline: none;
          border: none;
          padding: 15px 140px;
          cursor:pointer;
          border-radius: 5px;
        }
        .form-groub-submit button[disabled]{
          color: #6d6d6d;
          background: #e6e6e6;
        }

        .form-groub-forgot{
          text-align: center;
          font-size: 14px;
        }
        .form-groub-forgot a{
          color:#5b85c2;
          text-decoration: none;
          font-size: 1.2em;
        }
        .err{
          font-size:0.8em;
          color:red;
          position: absolute;
        }
        .err.login{
          display: inline-block;
          text-align: center;
          width: 390px;
        }
        .forgot-modal{
          position: fixed;
          top: 40%;
          min-width: 500px;
          padding: 15px;
          font-size: 1.2em;
          background: #fff;
          box-shadow: 1px 1px 19px #0009;
          border-radius: 2px;
          max-width: 90%;
          width: 70%;
          margin: 0 15%;
        }
        .forgot-modal-background{
          display:none;
          background: #00000085;
          position: fixed;
          width: 100%;
          height: 100%;
          top: 0;
          left: 0;
        }
        .action-btn button{
          background-color: #006599;
          color: #FFFFFF;
          padding: 12px 25px;
          font-size: 14px;
          border: none;
          border-radius: 5px;
          cursor:pointer;
        }
        .modal-footer {
          padding: 10px 0 0;
          text-align: right;
        }
        button.no{
          color:#006599;
          background-color:#fff;
        }
        .error-box{
          position: fixed;
          left: 35px;
          bottom: -30px;
          padding: 20px;
          color: #fff;
          background: #000;
          border-radius: 3px;
          transition:0.3s all;
          visibility:hidden;
        }
        .error-box.show{
          bottom: 40px;
          visibility:visible;
        }
        .forgot-password{
          cursor:pointer;
        }
      </style>

      <div class="login">
        <img src="../SVG/big-hexagon.svg">
        <div class="login-form">
          <div class="images">
            <div class="left-img">
              <img src="../SVG/flytxt-logo.svg" alt="" />
            </div>
            <div class="right-img">
              <img src="../SVG/neon-dx.svg" alt="" />
            </div>
          </div>
          <div class="form-groub">
            <input type="text" id="username" value="flyops@flytxt.com" >
            <label for="username">Username</label>
            <span class="err username" style="display:none">Invalid Username</span>
          </div>  
          <div class="form-groub">
            <input type="password" id="password" value="flytxt">
            <label for="password">Password</label>
            <span class="err password" style="display:none">Invalid Username</span>
          </div>
          <div class="form-groub-checkbox">
            <div>
            <input type="checkbox" id="remeberMe" checked> <label for="rememberMe">Remember Me</label>
            </div>
          </div>
          <div class="form-groub-submit">
            <button id="login-submit" disabled>Sign In <img src="../SVG/arrows.svg"></button>
            <span class="err login" style="display:none">Invalid Username/Password</span>
          </div>
          <div class="form-groub-forgot">
            <a class="forgot-password">Forgot Password</a>
          </div>
        </div>
        <div class="forgot-modal-background">
          <div class="forgot-modal">
            <div class="modal-header">The system will reset your password and send the new password to the registered email ID. Do you want to continue?</div>
            <div class="modal-footer">
              <div class="action-btn">
                <button class="no">No</button>
                <button class="yes">Yes</button>
              </div>
            </div>
          </div>
        </div>
        <div class="error-box">
          Please provide valid username.
        </div>
      </div>
    `;
    this.attachShadow({mode: 'open'});
    this.shadowRoot.appendChild(template.content.cloneNode(true));

    /*for input focus effect*/
    this.shadowRoot.querySelectorAll('.form-groub input').forEach(input=>{
      input.addEventListener('input',e=>{ (e.target.value.length > 0) ? e.target.classList.add('has-value') :e.target.classList.remove('has-value');
        this.checkValidation();
      });
    });
    
  }
  checkValidation(){
    let username=this.shadowRoot.querySelector("#username");
    let password=this.shadowRoot.querySelector("#password");
    let rememberMe=this.shadowRoot.querySelector("#remeberMe");

    //has value check
    if(username.value.length > 0) username.classList.add('has-value'); else username.classList.remove('has-value');
    if(password.value.length > 0) password.classList.add('has-value'); else password.classList.remove('has-value');

    let err=0;
    if(username.value.length < 4){
      this.shadowRoot.querySelector('.err.username').style.display="block";
      err++;
    }else{
      this.shadowRoot.querySelector('.err.username').style.display="none";
    }
    if(password.value.length < 4){
      this.shadowRoot.querySelector('.err.password').style.display="block";
      err++;
    }else{
      this.shadowRoot.querySelector('.err.password').style.display="none";
    }

    if(err==0){
      this.shadowRoot.querySelector('#login-submit').disabled=false;
      this.shadowRoot.querySelector('#login-submit img').src="../SVG/arrow-white.svg";
      return {username:username.value,password:password.value,rememberMe:rememberMe.checked};
    }else{
      this.shadowRoot.querySelector('#login-submit').disabled=true;
      return false;
    }

  }
  connectedCallback(){
    this.checkValidation();
    this.shadowRoot.querySelector('#login-submit').addEventListener('click', (e) => {
      let val=this.checkValidation();
      if( val !== false){
        let url=(this.hasAttribute('login-url'))? this.getAttribute('login-url') :'http://192.168.150.45/neon-ws/login';
        let method="post";
        this.loginCheck(url,method,val.username,val.password,val.rememberMe)
          .then((res)=>{
            this.shadowRoot.querySelector('.err.login').style.display="none";
            location.href=this.getAttribute('redirect-url');
          })
          .catch((e)=>{
             this.shadowRoot.querySelector('.err.login').style.display="block";
          })
      }
      return false;
    });

    this.shadowRoot.querySelector('.forgot-password').addEventListener('click', (e) => {
      let username=this.shadowRoot.querySelector("#username");
      if(username && username.value.length > 3){
        this.shadowRoot.querySelector('.forgot-modal-background').style.display="block";
      }else{
        this.shadowRoot.querySelector('.error-box').classList.add('show');
        setTimeout(()=>{
          this.shadowRoot.querySelector('.error-box').classList.remove('show');
        },3000);
      }
    });

    this.shadowRoot.querySelector('.action-btn').addEventListener('click', (e)=>{
      if(e.target.classList.contains('yes')){

        this.resetPassword();
      }
      if(e.target.classList.contains('no')){
        this.shadowRoot.querySelector('.forgot-modal-background').style.display="none";
      }
      
    });
  }

  loginCheck(url,method,username,password,rememberMe){
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      xhr.open(method, url);
      xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      xhr.onload = function () {
        if (this.status >= 200 && this.status < 300) {
          resolve(xhr.response);
        } else {
          reject({
            status: this.status,
            statusText: xhr.statusText
          });
        }
      };
      xhr.onerror = function () {
        reject({
          status: this.status,
          statusText: xhr.statusText
        });
      };
      xhr.send(`username=${username}&password=${password}&remember-me=${rememberMe}`);
    });
  }

});

</script>